#include "delay.h"
#include "MatrixDisplay.h"
#include "tm4c123gh6pm.h"

// LED matrix patterns for hex digits 0-F
unsigned char num[16][5] = {
    {0xF7, 0xED, 0xDD, 0xBD, 0x7F}, // '0'
    {0xF1, 0xE9, 0xD9, 0xB9, 0x79}, // '1'
    {0xF7, 0xE1, 0xDE, 0x8D, 0x7F}, // '2'
    {0xF7, 0xE1, 0xDE, 0xB1, 0x7F}, // '3'
    {0xF5, 0xE5, 0xD1, 0xB9, 0x79}, // '4'
    {0xF7, 0xED, 0x8E, 0xB1, 0x7F}, // '5'
    {0xF7, 0xED, 0x8E, 0xBD, 0x7F}, // '6'
    {0xF7, 0xE1, 0xD9, 0xB9, 0x79}, // '7'
    {0xF7, 0xED, 0xDD, 0xBD, 0x7F}, // '8'
    {0xF7, 0xED, 0xD1, 0xB9, 0x7F}, // '9'
    {0xF7, 0xED, 0xDD, 0xB5, 0x7F}, // 'A'
    {0xF6, 0xED, 0xDD, 0xBD, 0x7F}, // 'B'
    {0xF7, 0xED, 0x8D, 0xBD, 0x7F}, // 'C'
    {0xF1, 0xE9, 0xDD, 0xBD, 0x7F}, // 'D'
    {0xF7, 0xED, 0x8E, 0xBD, 0x7F}, // 'E'
    {0xF7, 0xED, 0x8E, 0xB1, 0x7F}  // 'F'
};

// Function to initialize GPIO for Port F and Port D
void GPIO_Init() {
    SYSCTL->RCGCGPIO |= 0x28;  // Enable clock for Port D and Port F
    while ((SYSCTL->PRGPIO & 0x28) == 0); // ready

    // Set Port F & D as outputs
    GPIOF->DIR = 0xFF;  
    GPIOF->DEN = 0xFF;  

    GPIOD->DIR = 0xFF;  
    GPIOD->DEN = 0xFF;  
}

void display_hex_digit(unsigned char digit) {
    if (digit > 15) return;  // 0-F only

    for (int i = 0; i < 5; i++) {
        GPIOF->DATA = num[digit][i];  // Set Port F (segment data)
        GPIOD->DATA = ~(1 << i);      // Set Port D (row)
        delayMs(5);                  
    }
}
